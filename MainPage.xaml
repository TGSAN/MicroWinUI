<Page
    x:Class="MicroWinUI.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Toolbar  -->
        <StackPanel
            Grid.Row="0"
            Padding="12"
            Orientation="Horizontal"
            Spacing="12">
            <Button Click="LoadLeftVideo_Click" Content="Load Left" />
            <TextBlock
                x:Name="LeftFileText"
                VerticalAlignment="Center"
                Foreground="Gray"
                Text="No File" />
            <AppBarSeparator />
            <Button Click="LoadRightVideo_Click" Content="Load Right" />
            <TextBlock
                x:Name="RightFileText"
                VerticalAlignment="Center"
                Foreground="Gray"
                Text="No File" />
        </StackPanel>

        <!--  Video Area  -->
        <Grid
            x:Name="VideoContainer"
            Grid.Row="1"
            Background="Black"
            SizeChanged="VideoContainer_SizeChanged">
            <!--  Left Video (Base Layer)  -->
            <Grid x:Name="LeftPlayerContainer">
                <MediaPlayerElement
                    x:Name="Player1"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    AreTransportControlsEnabled="False"
                    Stretch="Uniform" />
            </Grid>

            <!--  Right Video (Overlay Layer)  -->
            <Grid x:Name="RightPlayerContainer">
                <MediaPlayerElement
                    x:Name="Player2"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    AreTransportControlsEnabled="False"
                    Stretch="Uniform" />
            </Grid>

            <!--  Interactive Overlay for Splitter  -->
            <Grid
                x:Name="OverlayCanvas"
                Background="Transparent"
                ManipulationDelta="OverlayCanvas_ManipulationDelta"
                ManipulationMode="TranslateX"
                PointerEntered="OverlayCanvas_PointerEntered"
                PointerExited="OverlayCanvas_PointerExited"
                PointerMoved="OverlayCanvas_PointerMoved"
                PointerPressed="OverlayCanvas_PointerPressed"
                PointerReleased="OverlayCanvas_PointerReleased">
                
                <Canvas x:Name="SplitterContainer">
                    <Rectangle
                        x:Name="SplitLine"
                        Width="2"
                        Fill="White" />
                    <Grid
                        x:Name="SplitThumb"
                        Width="24"
                        Height="24">
                        <Ellipse Fill="White" />
                        <Ellipse
                            Stroke="Gray"
                            StrokeThickness="2" />
                    </Grid>
                </Canvas>
            </Grid>
        </Grid>

        <!--  Transport Controls  -->
        <Grid
            Grid.Row="2"
            Padding="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Click="StepBack_Click" Content="&lt;" ToolTipService.ToolTip="Previous Frame" />
                <Button Click="PlayPause_Click" Content="Play/Pause" />
                <Button Click="StepForward_Click" Content="&gt;" ToolTipService.ToolTip="Next Frame" />
            </StackPanel>

            <Slider
                x:Name="TimeSlider"
                Grid.Column="1"
                Margin="12,0"
                VerticalAlignment="Center" 
                PointerPressed="TimeSlider_PointerPressed"
                PointerReleased="TimeSlider_PointerReleased"
                ValueChanged="TimeSlider_ValueChanged" />

            <TextBlock
                x:Name="TimeText"
                Grid.Column="2"
                VerticalAlignment="Center"
                FontFamily="Consolas"
                Text="00:00:00 / 00:00:00" />
        </Grid>
    </Grid>
</Page>
